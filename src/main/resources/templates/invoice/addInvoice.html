<!DOCTYPE html>
<html lang="en" >
<!--/* Styles, meta data, and title are included */-->
<head data-th-replace="~{fragments/header :: headerFragment}" >
  <meta charset="UTF-8" >
  <title >Thymeleaf Springboot </title >
</head >
<body >
<link data-th-href="@{/css/combo-box-search.css}" media="all" rel="stylesheet" type="text/css" />

<style>
    body {font-family: Arial, Helvetica, sans-serif;}

    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<!--/* Nav bar is included */-->
<nav data-th-replace="~{fragments/navBar :: navBarFragment}" ></nav >
<div class="container-fluid mt-3" >
  <div class="container-fluid" >
    <form action="/invoice" method="post" data-th-object="${invoice}" >
      <!--ledgers will list-->
      <div class="form-group" >
        <!--Ledgers item-->
        <div class="form-row " >
          <div class="col-2 text-right" >
            <label class="control-label" for="item" >Items :</label >
          </div >
          <div class="col-10 text-left" >
            <select id="item" class="form-control" tabindex="9" >
              <option value="" >Please select</option >
              <option data-th-each="ledger : ${ledgers}"
                      data-th-text="${'Item Name: '+ledger.item.name+'  Sell Price : '+ledger.item.sellPrice+'  Available quantity : '+ledger.quantity+'  Expired Date : '+ledger.expiredDate}"
                      data-th-value="${ledger.id}" >
                Please select
              </option >
            </select >
          </div >
        </div >
      </div >
      <!--selected ledger items-->
      <div class="form-group" >
        <div class="form-row" >
          <div class="container" >
            <div class="col" >
              <table class="table table-hover table-striped text-white" id="myTable" >
                <thead >
                <tr >
                  <th >Index</th >
                  <th >Item Name</th >
                  <th >Unit Price</th >
                  <th >Quantity</th >
                  <th >Line Total</th >
                </tr >
                </thead >
                <tbody >
                <!--Selected Item -->
                <tr >
                  <th ></th >
                  <th ></th >
                  <th ></th >
                  <th ></th >
                  <th ></th >
                </tr >
                </tbody >
                <tfoot >
                <tr >
                  <th colspan="4" class="text-right" ><label for="total">Total</label ></th >
                  <th ><input id="total" type="text" class="form-control" placeholder="Total Price" ></th >
                </tr >
                </tfoot >
              </table >
            </div >
          </div >
        </div >
      </div >
      <hr >
      <!--Payment Section-->
      <div class="form-group" >
        <div class="form-row" >
          <!--Discount-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="discountRatio" >Discount Ratio :</label >
              </div >
              <div class="col-md-8" >
                <select id="discountRatio" data-th-field="*{discountRatio}" class="form-control"
                        tabindex="9"
                        required >
                  <option value="" >Please select</option >
                  <option data-th-each="discountRatio : ${discountRatios}"
                          data-th-text="${discountRatio.amount}"
                          data-th-value="${discountRatio.id}" >
                    Please select
                  </option >
                </select >
              </div >
            </div >
          </div >
          <!--Discount Amount-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="discountAmount" >Discount Amount :</label >
              </div >
              <div class="col-md-8" >
                <input id="discountAmount" data-th-field="*{discountAmount}" class="form-control" tabindex="6"
                       type="text"
                       required readonly />
                <span class="error" id="nicError" data-th-errors="*{discountAmount}"
                      data-th-if="${#fields.hasErrors('discountAmount')}" >Error
                                                               Discount Amount</span >
              </div >
            </div >
          </div >
        </div >
        <!--Payment method and total amount-->
        <div class="form-row text-right" >
          <!--payment method-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label data-th-for="${paymentMethod}" >Payment Method:</label >
              </div >
              <div class="col-md-8 text-left" >
                <div class="custom-control custom-checkbox custom-control-inline "
                     data-th-each="paymentMethod,index : ${paymentMethods}" >
                  <input class="custom-control-input" required
                         data-th-name="${'paymentMethod'}"
                         data-th-value="${paymentMethod}"
                         data-th-id="${index.index}+${paymentMethod}" type="radio"
                  />
                  <label class="custom-control-label"
                         data-th-for="${index.index}+${paymentMethod}"
                         data-th-text="${paymentMethod.paymentMethod}" > radio
                  </label >
                </div >
              </div >
            </div >
          </div >
          <!--Total Amount-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="totalAmount" >Total Amount :</label >
              </div >
              <div class="col-md-8" >
                <input id="totalAmount" data-th-field="*{totalAmount}" class="form-control" tabindex="6"
                       type="text"
                       required readonly />
                <span class="error" id="totalAmountError" data-th-errors="*{balance}"
                      data-th-if="${#fields.hasErrors('totalAmount')}" ></span >
              </div >
            </div >
          </div >
        </div >
        <!--Amount tendered and balance  -->
        <div class="form-row text-right" id="cashPaymentBlock" >
          <!--Amount Tendered-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="amountTendered" >Amount Tendered :</label >
              </div >
              <div class="col-md-8" >
                <input id="amountTendered" data-th-field="*{amountTendered}"
                       class="form-control"
                       tabindex="6" type="text"
                       required />
                <span class="error" data-th-errors="*{amountTendered}"
                      data-th-if="${#fields.hasErrors('amountTendered')}" ></span >
              </div >
            </div >
          </div >
          <!--Balance-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="balance" >Balance :</label >
              </div >
              <div class="col-md-8" >
                <input id="balance" data-th-field="*{balance}" class="form-control" tabindex="6"
                       type="text"
                       required readonly />
                <span class="error" id="balanceError" data-th-errors="*{balance}"
                      data-th-if="${#fields.hasErrors('balance')}" ></span >
              </div >
            </div >
          </div >
        </div >
        <!-- Card Payment -> Bank and card Number -->
        <div class="form-row text-right" id="bankNameBlock" >
          <!--Bank -->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="bankName" >Bank Name Tendered :</label >
              </div >
              <div class="col-md-8" >
                <input id="bankName" data-th-field="*{bankName}"
                       class="form-control"
                       tabindex="6" type="text" />
                <span class="error" data-th-errors="*{bankName}"
                      data-th-if="${#fields.hasErrors('bankName')}" ></span >
              </div >
            </div >
          </div >
          <!--card number-->
          <div class="col-md-6 " >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label class="control-label" for="cardNumber" >Card Number :</label >
              </div >
              <div class="col-md-8" >
                <input id="cardNumber" data-th-field="*{cardNumber}" class="form-control" tabindex="6"
                       type="text" />
                <span class="error" data-th-errors="*{cardNumber}"
                      data-th-if="${#fields.hasErrors('cardNumber')}" ></span >
              </div >
            </div >
          </div >
        </div >
      </div >
      <hr >
      <!--customer list-->
      <div class="form-group" >
        <!--Customers-->
        <div class="form-row text-right" >
          <div class="col-md-2" >
            <label class="control-label" for="customer " >Customer :</label >
          </div >
          <div class="col-md-10" >
            <select id="customer " data-th-field="*{customer}" class="form-control" tabindex="9"
                    required >
              <option value="" >Please select</option >
              <option data-th-each="customer : ${customers}"
                      data-th-text="${customer.name+'  '+customer.mobile}"
                      data-th-value="${customer.id}" >
                Please select
              </option >
            </select >
          </div >
        </div >
      </div >
      <hr >
      <!--remarks and invoice print or not-->
      <div class="form-group" >
        <div class="form-row" >
          <div class="col-md-6" >
            <!--invoice print or not-->
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label data-th-for="${invoicePrintOrNot}" >Invoice Print or Not:</label >
              </div >
              <div class="col-md-8 text-left" >
                <div class="custom-control custom-checkbox custom-control-inline "
                     data-th-each="invoicePrintOrNot,index : ${invoicePrintOrNots}" >
                  <input class="custom-control-input" required
                         data-th-name="${'invoicePrintOrNot'}"
                         data-th-value="${invoicePrintOrNot}"
                         data-th-id="${index.index}+${invoicePrintOrNot}" type="radio"
                  />
                  <label class="custom-control-label"
                         data-th-for="${index.index}+${invoicePrintOrNot}"
                         data-th-text="${invoicePrintOrNot.invoicePrintOrNot}" > radio
                  </label >
                </div >
              </div >
            </div >
          </div >
          <!--Remarks-->
          <div class="col-md-6" >
            <div class="form-row text-right" >
              <div class="col-md-4" >
                <label for="remarks">Remarks :</label ></div >
              <div class="col-md-8" >
                <textarea id="remarks" class="form-control" data-th-field="*{remarks}" rows="2" ></textarea >
              </div >
            </div >
          </div >
        </div >
      </div >
      <hr >
      <!--button-->
      <div class="form-group" >
        <!--Button-->
        <div class="form-group col-md-12 col-sm-12 text-center flex-column " >
          <!--Back Button-->
          <a class="btn btn-dark" href="/invoice" tabindex="14" >
            <i class="fas fa-arrow-circle-left" style="font-size: 20px" ></i >&nbsp;&nbsp;Back
          </a >
          <!--Save Button-->
          <button class="btn btn-success ml-5" tabindex="12" type="submit" >
            <i class="fa fa-save " style="font-size: 20px" ></i >&nbsp;&nbsp;<span
                data-th-text="${'Save'}"
                id="submit" ></span >
          </button >
          <!--Cancel Button-->
          <button class="btn btn-warning ml-5" tabindex="13" type="reset" >
            <i class="far fa-times-circle" style="font-size: 20px" ></i >&nbsp;&nbsp;Cancel
          </button >
        </div >
      </div >
    </form >
  </div >
</div >

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">


    <span class="close">&times;</span>
    <p>Some text in the Modal..</p>
  </div>

</div>

<input type="hidden" data-th-value="${ledgerItemURL}" id="ledgerItemURL">
<!--/* footer is */-->
<div data-th-replace="~{fragments/footer :: footerFragment}" ></div >
<!--/* script is included */-->
<div data-th-replace="~{fragments/script :: scriptFragment}" ></div >
<script data-th-src="@{/js/combo-box-search.js}" ></script >
<script >
    $(document).ready(function () {
        $("#btnshow").hide();

        let customers = ["Australia", "Bangladesh", "Denmark", "Hong Kong", "Indonesia", "Netherlands", "New Zealand", "South Africa"];
        $("#item").select2({
            data: customers
        }).change(() => {
                modalPopUp();

            });

        $("#customer").select2({
            data: $(this).val()
        });
        $("input[value='CASH']").prop('checked', true);
        showHideContent();
        $("input[value='NOT_PRINTED']").prop('checked', true);

    });

    $("input[name='paymentMethod']").bind('change', function () {
        showHideContent();
    });

    function showHideContent() {
        let paymentMethodValue = $("input[name='paymentMethod']:checked").val();
        if (paymentMethodValue === 'CASH') {
            $("#bankNameBlock").hide();
            $("#cashPaymentBlock").show();
            $("#amountTendered, #balance").prop('required', true);
        } else {
            $("#cashPaymentBlock").hide();
            $("#bankNameBlock").show();
            $("#bankName, #cardNumber").prop('required', true);
        }
    }

    //enter amount check
    // $("#amount").bind('keyup', function () {
    //     let amountString = $(this).val();
    //     balanceCalculate(amountString);
    // });
    //
    // function balanceCalculate(amountString) {
    //     let poValue = parseInt($("#allAmount").val());
    //     let poAmountString = $("#poAmount").val();
    //     let poAmount = parseInt(poAmountString);
    //     let amount = parseInt(amountString);
    //
    //     $("#balance").val(parseFloat(balance(poValue, amount)).toFixed(2));
    //
    //     if ((poAmount !== amount && poAmountString.length === amountString.length) && (amount > poAmount &&
    //         poAmountString.length === amountString.length) || balance(poValue, amount) < 0) {
    //         swal({
    //             title: "Could you accept this amount as a payment.. !",
    //             icon: "warning",
    //             text: "Please check what your are entered. \n",
    //         });
    //         $("#balance").val(parseFloat(0).toFixed(2));
    //         $("#amount").val(parseFloat(poAmount).toFixed(2));
    //     }
    //
    // }
    //
    // function balance(poValue, amount) {
    //     return poValue - amount;
    // }


    // Get the modal
    let modal = document.getElementById("myModal");
    // Get the <span> element that closes the modal
    let span = document.getElementsByClassName("close")[0];

    function modalPopUp(){
        optionElementRemove("#item");
        modal.style.display = "block";
     //let  finalUrl =   $('#ledgerItemURL').val()+$("#item").val();
     let  finalUrl =   $('#ledgerItemURL').val()+1;
        $.ajax({
            type: 'GET',
            url: finalUrl,
            success: function (resp) {
                alert("dsadas")
                console.trace( resp);
                optionElementRemove("#item");
            },
            error: function (err) {
                console.log(err);
            }
        });
    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    //option tag remove
    let optionElementRemove = (id) =>{
        let selectedValue = $(id).val();
        let selectedItemId = `${id} option[value='${selectedValue}']`;
        $(selectedItemId).remove();
    }

</script >
</body >
</html >
